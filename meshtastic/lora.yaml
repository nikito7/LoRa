# Home Assistant Package
# Meshtastic

mqtt:
#2
  sensor:
###4
#    - name: "LoRa GW1 Raw"
#      unique_id: LoRa_GW1_Raw
#      state_topic: "msh/2/json/PublicData/!157538d4"
#      value_template: >
#        {{ value_json.payload.text }}
#
###4
    - name: "LoRa Sensor Soil ID"
      unique_id: LoRa_Sensor_Soil_ID
      state_topic: "msh/2/json/PublicData/!157538d4"
      value_template: >
        {% set msg = value_json['payload']['text'] %}
        {% set id = (msg|from_json)['id'] %}
        {% if id == "sensor_soil" %}
          {{ id }}
        {% endif %}

    - name: "LoRa Sensor Soil Temp"
      unique_id: LoRa_Sensor_Soil_Temp
      state_topic: "msh/2/json/PublicData/!157538d4"
      value_template: >
        {% set msg = value_json['payload']['text'] %}
        {% set id = (msg|from_json)['id'] %}
        {% set x = (msg|from_json)['t'] %}
        {% if id == "sensor_soil" and x > -99 and x < 100 %}
          {{ x }}
        {% endif %}
      unit_of_measurement: "Â°C"
      state_class: measurement
      device_class: temperature

    - name: "LoRa Sensor Soil Hum"
      unique_id: LoRa_Sensor_Soil_Hum
      state_topic: "msh/2/json/PublicData/!157538d4"
      value_template: >
        {% set msg = value_json['payload']['text'] %}
        {% set id = (msg|from_json)['id'] %}
        {% set x = (msg|from_json)['h'] %}
        {% if id == "sensor_soil" and x > -99 and x < 100 %}
          {{ x }}
        {% endif %}
      unit_of_measurement: "%"
      state_class: measurement
      device_class: humidity

# EOF

