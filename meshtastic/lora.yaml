# Home Assistant Package
# Meshtastic

mqtt:
#2
  sensor:
###4
#    - name: "LoRa GW1 Raw"
#      unique_id: LoRa_GW1_Raw
#      state_topic: "home/msh/2/json/PublicData/!157538d4"
#      value_template: >
#        {{ value_json.payload }}
###4
    - name: "LoRa GW1 Pressure"
      unique_id: LoRa_GW1_Pres
      state_topic: "home/msh/2/json/LongFast/!157538d4"
      value_template: >
        {% set from = value_json.from %}
        {% set x = value_json.payload.barometric_pressure|round(1) %}
        {% if x > 0 and from == "360003796" %}
          {{ x }}
        {% else %}
          {{ is_state('sensor.lora_gw1_pressure') }}
        {% endif %}
      state_class: measurement
      device_class: pressure
      unit_of_measurement: hPa

    - name: "LoRa Sensor Soil ID"
      unique_id: LoRa_Sensor_Soil_ID
      state_topic: "home/msh/2/json/PublicData/!157538d4"
      value_template: >
        {% set id = value_json.payload.id %}
        {% if id == "sensor_soil" %}
          {{ id }}
        {% endif %}
      
    - name: "LoRa Sensor Soil Temperature"
      unique_id: LoRa_Sensor_Soil_Temp2
      state_topic: "home/msh/2/json/PublicData/!157538d4"
      value_template: >
        {% set id = value_json.payload.id %}
        {% set x = value_json.payload.t %}
        {% if id == "sensor_soil" and x > -99 and x < 100 %}
          {{ x }}
        {% else %}
          {{ is_state('sensor.lora_sensor_soil_temperature') }}
        {% endif %}
      state_class: measurement
      device_class: temperature

    - name: "LoRa Sensor Soil Humidity"
      unique_id: LoRa_Sensor_Soil_Hum2
      state_topic: "home/msh/2/json/PublicData/!157538d4"
      value_template: >
        {% set id = value_json.payload.id %}
        {% set x = value_json.payload.h %}
        {% if id == "sensor_soil" and x > -99 and x < 100 %}
          {{ x }}
        {% else %}
          {{ is_state('sensor.lora_sensor_soil_humidity') }}
        {% endif %}
      state_class: measurement
      device_class: humidity

# EOF

