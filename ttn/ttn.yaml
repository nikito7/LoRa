# Home Assistant Package
# ttn
# Bridge:
# - mqtt to mqtt
# - v3 to home/v3

### ### ###

mqtt:
#2
  sensor:
###4
    - name: "LoRa Counter"
      unique_id: EB5_LoRa_Counter
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {{ value_json.uplink_message.f_cnt }}
        {% endif %}
      state_class: measurement
      device:
        identifiers: nikito7-EB5
        name: EB5
        model: Easy HAN
        manufacturer: nikito7
###4
    - name: "LoRa rssi"
      unique_id: EB5_LoRa_rssi
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
        {% set x = value_json.uplink_message.rx_metadata.0.rssi %}
          {{ x }}
        {% endif %}
      state_class: measurement
      device_class: signal_strength
      unit_of_measurement: dBm
      device:
        identifiers: nikito7-EB5

########### HAN ##########
###4
    - name: "Clock"
      unique_id: EB5_Clock
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {% if value_json.uplink_message.decoded_payload is defined %}
            {% if value_json.uplink_message.decoded_payload.AAc is defined %}
              {{ value_json.uplink_message.decoded_payload.AAc|string }}
            {% endif %}          
          {% endif %}
        {% endif %}
      icon: mdi:clock
      device:
        identifiers: nikito7-EB5
###4
    - name: "Voltage L1"
      unique_id: EB5_VolL1
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {% if value_json.uplink_message.decoded_payload is defined %}
            {% if value_json.uplink_message.decoded_payload.VL1 is defined %}
              {% set x = value_json.uplink_message.decoded_payload.VL1|float(0) %}
              {% if x > 0 %}
                {{ x }}
              {% endif %}
            {% endif %}
          {% endif %}
        {% endif %}
      unit_of_measurement: "V"
      device_class: voltage
      state_class: measurement
      device:
        identifiers: nikito7-EB5
###4
    - name: "Voltage L2"
      unique_id: EB5_VolL2
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {% if value_json.uplink_message.decoded_payload is defined %}
            {% if value_json.uplink_message.decoded_payload.VL2 is defined %}
              {% set x = value_json.uplink_message.decoded_payload.VL2|float(0) %}
              {% if x > 0 %}
                {{ x }}
              {% endif %}
            {% endif %}
          {% endif %}
        {% endif %}
      unit_of_measurement: "V"
      device_class: voltage
      state_class: measurement
      device:
        identifiers: nikito7-EB5
###4
###4
    - name: "Voltage L3"
      unique_id: EB5_VolL3
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {% if value_json.uplink_message.decoded_payload is defined %}
            {% if value_json.uplink_message.decoded_payload.VL3 is defined %}
              {% set x = value_json.uplink_message.decoded_payload.VL3|float(0) %}
              {% if x > 0 %}
                {{ x }}
              {% endif %}
            {% endif %}
          {% endif %}
        {% endif %}
      unit_of_measurement: "V"
      device_class: voltage
      state_class: measurement
      device:
        identifiers: nikito7-EB5
###4
###4
    - name: "Current L1"
      unique_id: EB5_CurL1
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {% if value_json.uplink_message.decoded_payload is defined %}
            {% if value_json.uplink_message.decoded_payload.CL1 is defined %}
              {{ value_json.uplink_message.decoded_payload.CL1|float(0.0) }}
            {% endif %}
          {% endif %}
        {% endif %}
      unit_of_measurement: "A"
      device_class: current
      state_class: measurement
      device:
        identifiers: nikito7-EB5
###4
    - name: "Current L2"
      unique_id: EB5_CurL2
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {% if value_json.uplink_message.decoded_payload is defined %}
            {% if value_json.uplink_message.decoded_payload.CL2 is defined %}
              {{ value_json.uplink_message.decoded_payload.CL2|float(0.0) }}
            {% endif %}
          {% endif %}
        {% endif %}
      unit_of_measurement: "A"
      device_class: current
      state_class: measurement
      device:
        identifiers: nikito7-EB5
###4
    - name: "Current L3"
      unique_id: EB5_CurL3
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {% if value_json.uplink_message.decoded_payload is defined %}
            {% if value_json.uplink_message.decoded_payload.CL3 is defined %}
              {{ value_json.uplink_message.decoded_payload.CL3|float(0.0) }}
            {% endif %}
          {% endif %}
        {% endif %}
      unit_of_measurement: "A"
      device_class: current
      state_class: measurement
      device:
        identifiers: nikito7-EB5
###4
###4
    - name: "Current"
      unique_id: EB5_Current
      state_topic: "home/v3/nikito-app@ttn/devices/eui-70b3d57ed00617fe/up"
      value_template: >
        {% if value_json.uplink_message is defined %}
          {% if value_json.uplink_message.decoded_payload is defined %}
            {% if value_json.uplink_message.decoded_payload.CLT is defined %}
              {{ value_json.uplink_message.decoded_payload.CLT|float(0.0) }}
            {% endif %}
          {% endif %}
        {% endif %}
      unit_of_measurement: "A"
      device_class: current
      state_class: measurement
      device:
        identifiers: nikito7-EB5
###4
# EOF



